# Javascript(2)

---

## 作用域

当代码在一个环境中执行时，会创建变量对象的一个作用域链，可以保证对执行环境有权访问的所有变量和函数的有序访问，在作用域链的前端，始终都是当前执行代码所在环境的变量对象。如果查找不到某个变量，则逐级向上查找，直到找到第一个变量。

js没有块级作用域只有函数级作用域

## 垃圾收集

* 标记清除:对于进入函数作用域的变量会被标记为进入环境，而当执行完函数后，变量会被标记为离开环境，js会自动收集处理这些变量（一定时间间隔处理一次，循环执行）

* 引用计数：指的是跟踪每个值被引用的次数，多一次引用就加一，引用被覆盖就减一，知道减为零，会被收集

由于有标记清除机制，所以函数作用域的变量会自动处理，而全局的变量需要我们手动处理，比如给不用的变量赋值为null。

## 引用类型

### Object

创建Object实例有两种方法

```javascript
var p = new Object(); p.name = "bin";
var p = {name:"bin"};
```

object实例访问属性有两种方法

```javascript
p.name
p["name"]
```

### Array

#### 创建数组

```javascript
var arr = new Array() //参数为数字则是定义长度，其他数据类型，则是定义项
var arr = [1,2,3]
```

#### 检测数组

* 使用instance操作符，但是对于多框架的情况下，有多个Array构造函数，所以不可靠
* Array.isArray(val)，比较适合

#### 转换方法

* toString()会返回数组每一项以字符串形式拼接而成的以逗号分隔的字符串
* valueof()还是会返回数组
* join()方法，可是使数组转化成，以参数分隔的字符串，如果没有参数，或者参数使undefined，那么将用逗号分隔

#### 栈方法

LIFO

* push():用于将任意参数添加到数组末尾，返回新数组长度
* pop():删除数组最后一项，返回删除项

#### 队列方法

FIFO

* unshift():将任意多项添加到数组前面，返回新数组长度
* shift():删除数组第一项，返回删除项

#### 重排序方法

* reverse()用于将数组倒置
* sort()可以使数组升序排列，不过它调用的是数组每项的toString()方法，所以数字比较是编码值，导致不准确，可以传递一个参数
    ```javascript
    funtion(value1,value2){
        if(value1 < value2){
            return -1;
        }else if(value1 > value2){
            return 1;
        }else{
            return 0;
        }
    }
    对于纯数字比较，可以使用
    function(value1,value2){
        return value1 - value2;
    }
    ```

#### 操作方法

* contact()方法:接受项或者数组，拼接在数组后面，返回新数组。如果不传参数，则返回数组的一个副本
* slice():用于截取数组，接受两个参数，从第一个参数的索引开始，到第二个参数索引结束（不包括），如果不传第二个参数，会一直截取到最后一项
* splice():接受三个及以上参数，第一个为起始索引，第二个为删除数目，第三个及以上为插入项。（改变原数组）

#### 位置方法

* indexOf():接受两参数，第一个是查找项，第二个（可选）是开始查找的位置，没找到则返回-1
* lastIndexOf():反向查找，接受两参数，第一个是查找项，第二个（可选）是开始查找的位置，没找到则返回-1

#### 迭代方法

以下每个方法都接受两个参数，一个是处理函数，另一个（可选，是作用域this）。另外处理函数都可以接受三个参数，第一个是数组项，第二个是该项的索引，第三个是原数组

```javascript
every():对数组每一项运行指定函数，如果每一项都返回true，则返回true

some():对数组每一项运行制定函数，如果有一项返回true，则返回true

filter():对数组每一项运行指定函数，返回该函数返回true的项，组成的数组

forEach():对数组每一项执行指定函数，没有返回值

map():对数组每一项运行制定函数，返回函数返回结果组成的数组
```

#### 归并方法

* reduce和reduceRight，都接受两个参数，一个是每一项上调用的函数，另一个是起始值。函数接受四个参数，依此是
  * 前一个值
  * 当前值
  * 项的索引
  * 数组对象

### Date类型

日期实例使用Date()构造函数来实例化

参数是毫秒数，不传入参数，创建的对象是当前时间的对象。

有两个方法可以转化日期为毫秒数

* Date.parse()接受字符串参数(实际上直接传递给Date构造函数字符串，也会调用Date.parse()方法)
  * 月/日/年，如11/21/2017
  * 英文月名 日,年
  * 英文星期 英文月 日 年 时:分:秒 时区
  * YYYY-MM-DDTHH:mm:ss.sssZ
* Date.UTC():参数为年份、基于0的月份、月中的哪一天、小时数、分钟、秒、毫秒数。只有年月是必须的其余省略，都会被设为0(Date()构造函数也接受UTC格式的参数，它是基于本地时区的)
  * Date.UTC(2017,10,24,17,20,20,100) //2017-11-24 17:20:20

Date.now()方法返回的是调用这个方法的日期和时间的毫秒数

Date的实例同样有toString()、toLocaleString()、valueOf()方法，可以直接比较两个时间的大小，因为valueOf()会把实例转化为毫秒数

常用实例方法

```js
getTime():获取毫秒数

getFullYear():获取四位数年份

getMonth():获取基于0的月份

getDate():返回日期月份中的天数

getDay():返回日期中的星期几

getHours():基于0的小时数

getMinutes():基于0的分钟数

getSeconds():返回日期中的秒数

getMilliseconds():返回日期中的毫秒数
```

### RegExp类型

#### 创建

* 字面量：var expression = /pattern/flags
  * pattern为任意正则表达式
  * flags为标志，包括：
    * g(global)：全局模式
    * i(case-insensitive)：不区分大小写
    * m(multiline)：多行模式
* 构造函数：var expression = new RegExp("pattern,"flags")

注意：元字符需要转义：(),[],{},\,^,$,|,?,*,+,.（构造函数模式则需要双重转义）

#### 实例属性

```javascript
global：是否设置了g标志

ignoreCasw：是否设置了i标志

lastIndex：表示开始搜索下一个匹配项的字符位置

multiline：是否设置了m标志

source：正则表达式的字符串表示（按字面量形式）
```

#### 实例方法

* exec()：接受一个参数，即应用模式的字符串。返回一个数组，数组第一项是与整个模式匹配的字符串，其他项则是与模式捕获组匹配的字符串。另外，这个数组有两个属性
  * input：表示应用正则表达式的字符串
  * index：表示匹配项在字符串中的位置
  * 如果模式有g标志，那么再次使用exec方法会从上次匹配位置开始
* test()：接受字符串参数，如果模式与参数匹配，返回true，否则返回false。

### Function类型

